diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/iTerm2.xcodeproj/project.pbxproj iTerm2-patched/iTerm2.xcodeproj/project.pbxproj
*** iTerm2/iTerm2.xcodeproj/project.pbxproj	2018-05-26 17:14:30.000000000 +1000
--- iTerm2-patched/iTerm2.xcodeproj/project.pbxproj	2018-05-25 22:14:31.000000000 +1000
***************
*** 8150,8156 ****
  						DevelopmentTeam = H7V7XYVQ7D;
  					};
  					874206460564169600CFC3F1 = {
! 						DevelopmentTeam = H7V7XYVQ7D;
  						ProvisioningStyle = Automatic;
  					};
  					A66717851DCE36C3000CE608 = {
--- 8150,8156 ----
  						DevelopmentTeam = H7V7XYVQ7D;
  					};
  					874206460564169600CFC3F1 = {
! 						DevelopmentTeam = 4688J3MK2P;
  						ProvisioningStyle = Automatic;
  					};
  					A66717851DCE36C3000CE608 = {
***************
*** 10110,10116 ****
  				CODE_SIGN_STYLE = Automatic;
  				COMBINE_HIDPI_IMAGES = YES;
  				COPY_PHASE_STRIP = YES;
! 				DEVELOPMENT_TEAM = H7V7XYVQ7D;
  				FRAMEWORK_SEARCH_PATHS = (
  					"$(inherited)",
  					"$(SRCROOT)",
--- 10110,10116 ----
  				CODE_SIGN_STYLE = Automatic;
  				COMBINE_HIDPI_IMAGES = YES;
  				COPY_PHASE_STRIP = YES;
! 				DEVELOPMENT_TEAM = 4688J3MK2P;
  				FRAMEWORK_SEARCH_PATHS = (
  					"$(inherited)",
  					"$(SRCROOT)",
***************
*** 10759,10765 ****
  				CODE_SIGN_STYLE = Automatic;
  				COMBINE_HIDPI_IMAGES = YES;
  				COPY_PHASE_STRIP = YES;
! 				DEVELOPMENT_TEAM = H7V7XYVQ7D;
  				FRAMEWORK_SEARCH_PATHS = (
  					"$(inherited)",
  					"$(SRCROOT)",
--- 10759,10765 ----
  				CODE_SIGN_STYLE = Automatic;
  				COMBINE_HIDPI_IMAGES = YES;
  				COPY_PHASE_STRIP = YES;
! 				DEVELOPMENT_TEAM = 4688J3MK2P;
  				FRAMEWORK_SEARCH_PATHS = (
  					"$(inherited)",
  					"$(SRCROOT)",
***************
*** 11799,11805 ****
  				COMBINE_HIDPI_IMAGES = YES;
  				COPY_PHASE_STRIP = NO;
  				DEBUG_INFORMATION_FORMAT = dwarf;
! 				DEVELOPMENT_TEAM = H7V7XYVQ7D;
  				FRAMEWORK_SEARCH_PATHS = (
  					"$(inherited)",
  					"$(SRCROOT)",
--- 11799,11805 ----
  				COMBINE_HIDPI_IMAGES = YES;
  				COPY_PHASE_STRIP = NO;
  				DEBUG_INFORMATION_FORMAT = dwarf;
! 				DEVELOPMENT_TEAM = 4688J3MK2P;
  				FRAMEWORK_SEARCH_PATHS = (
  					"$(inherited)",
  					"$(SRCROOT)",
***************
*** 11875,11881 ****
  				CODE_SIGN_STYLE = Automatic;
  				COMBINE_HIDPI_IMAGES = YES;
  				COPY_PHASE_STRIP = YES;
! 				DEVELOPMENT_TEAM = H7V7XYVQ7D;
  				FRAMEWORK_SEARCH_PATHS = (
  					"$(inherited)",
  					"$(SRCROOT)",
--- 11875,11881 ----
  				CODE_SIGN_STYLE = Automatic;
  				COMBINE_HIDPI_IMAGES = YES;
  				COPY_PHASE_STRIP = YES;
! 				DEVELOPMENT_TEAM = 4688J3MK2P;
  				FRAMEWORK_SEARCH_PATHS = (
  					"$(inherited)",
  					"$(SRCROOT)",
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/iTerm2.xcodeproj/project.xcworkspace/xcshareddata/IDEWorkspaceChecks.plist iTerm2-patched/iTerm2.xcodeproj/project.xcworkspace/xcshareddata/IDEWorkspaceChecks.plist
*** iTerm2/iTerm2.xcodeproj/project.xcworkspace/xcshareddata/IDEWorkspaceChecks.plist	1970-01-01 10:00:00.000000000 +1000
--- iTerm2-patched/iTerm2.xcodeproj/project.xcworkspace/xcshareddata/IDEWorkspaceChecks.plist	2018-05-25 22:14:26.000000000 +1000
***************
*** 0 ****
--- 1,8 ----
+ <?xml version="1.0" encoding="UTF-8"?>
+ <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
+ <plist version="1.0">
+ <dict>
+ 	<key>IDEDidComputeMac32BitWarning</key>
+ 	<true/>
+ </dict>
+ </plist>
Binary files iTerm2/iTerm2.xcodeproj/project.xcworkspace/xcuserdata/jason.xcuserdatad/UserInterfaceState.xcuserstate and iTerm2-patched/iTerm2.xcodeproj/project.xcworkspace/xcuserdata/jason.xcuserdatad/UserInterfaceState.xcuserstate differ
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/PTYSession.m iTerm2-patched/sources/PTYSession.m
*** iTerm2/sources/PTYSession.m	2018-05-26 17:14:30.000000000 +1000
--- iTerm2-patched/sources/PTYSession.m	2018-05-25 22:14:57.000000000 +1000
***************
*** 3578,3584 ****
          if (baseIsBookmarkName && ![iTermPreferences boolForKey:kPreferenceKeyShowProfileName]) {
              return [NSString stringWithFormat:@"%@", self.jobName];
          } else {
!             return [NSString stringWithFormat:@"%@ (%@)", base, self.jobName];
          }
      } else {
          if (baseIsBookmarkName && ![iTermPreferences boolForKey:kPreferenceKeyShowProfileName]) {
--- 3578,3584 ----
          if (baseIsBookmarkName && ![iTermPreferences boolForKey:kPreferenceKeyShowProfileName]) {
              return [NSString stringWithFormat:@"%@", self.jobName];
          } else {
!             return [NSString stringWithFormat:@"%@", base]; // PATCH: (Modified) don't show job name if title was set
          }
      } else {
          if (baseIsBookmarkName && ![iTermPreferences boolForKey:kPreferenceKeyShowProfileName]) {
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/PTYTextView.m iTerm2-patched/sources/PTYTextView.m
*** iTerm2/sources/PTYTextView.m	2018-05-26 17:14:30.000000000 +1000
--- iTerm2-patched/sources/PTYTextView.m	2018-05-26 16:49:38.000000000 +1000
***************
*** 2614,2620 ****
  
  - (void)_openTargetWithEvent:(NSEvent *)event inBackground:(BOOL)openInBackground {
      // Command click in place.
!     NSPoint clickPoint = [self clickPoint:event allowRightMarginOverflow:NO];
      int x = clickPoint.x;
      int y = clickPoint.y;
      iTermTextExtractor *extractor = [iTermTextExtractor textExtractorWithDataSource:_dataSource];
--- 2614,2620 ----
  
  - (void)_openTargetWithEvent:(NSEvent *)event inBackground:(BOOL)openInBackground {
      // Command click in place.
!     NSPoint clickPoint = [self clickPoint:event allowRightMarginOverflow:YES]; // PATCH: (Modified) fix URL command click?
      int x = clickPoint.x;
      int y = clickPoint.y;
      iTermTextExtractor *extractor = [iTermTextExtractor textExtractorWithDataSource:_dataSource];
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/PseudoTerminal.m iTerm2-patched/sources/PseudoTerminal.m
*** iTerm2/sources/PseudoTerminal.m	2018-05-26 17:14:30.000000000 +1000
--- iTerm2-patched/sources/PseudoTerminal.m	2018-05-26 15:59:35.000000000 +1000
***************
*** 388,393 ****
--- 388,394 ----
      if (hotkeyWindowType == iTermHotkeyWindowTypeFloatingPanel) {
          mask = NSNonactivatingPanelMask;
      }
+     //mask = NSFullSizeContentViewWindowMask; // PATCH: (Added) Make content view utilise entire window
      switch (windowType) {
          case WINDOW_TYPE_TOP:
          case WINDOW_TYPE_BOTTOM:
***************
*** 639,645 ****
          [myWindow setFrame:initialFrame display:NO];
      }
  
!     [myWindow setHasShadow:(windowType == WINDOW_TYPE_NORMAL)];
  
      DLog(@"Create window %@", myWindow);
  
--- 640,649 ----
          [myWindow setFrame:initialFrame display:NO];
      }
  
!     [myWindow setHasShadow:YES]; // PATCH: (Modified) Native macOS window shadow
!     
!     myWindow.titlebarAppearsTransparent = true; // PATCH: (Added) Hides dark title bar strip
!     //myWindow.titleVisibility = NSWindowTitleHidden; // PATCH: (Added) Hides window title
  
      DLog(@"Create window %@", myWindow);
  
***************
*** 1663,1676 ****
          if (self.window.frame.size.width < 250) {
              aTitle = [NSString stringWithFormat:@"%d✕%d", session.columns, session.rows];
          } else {
!             aTitle = [NSString stringWithFormat:@"%@ \u2014 %d✕%d",
!                       [self currentSessionName],
                        [session columns],
                        [session rows]];
          }
          [self setWindowTitle:aTitle];
      } else {
!         [self setWindowTitle:[self currentSessionName]];
      }
  }
  
--- 1667,1685 ----
          if (self.window.frame.size.width < 250) {
              aTitle = [NSString stringWithFormat:@"%d✕%d", session.columns, session.rows];
          } else {
!             // PATCH (Modified) just change to dimensions while resizing
!             aTitle = [NSString stringWithFormat:@"%d✕%d",
                        [session columns],
                        [session rows]];
          }
+         
          [self setWindowTitle:aTitle];
      } else {
!         // PATCH: (Added) Change title format
!         NSString *aTitle;
!         aTitle = [NSString stringWithFormat:[iTermAdvancedSettingsModel windowTitleFormat],
!                   [self currentSessionName]];
!         [self setWindowTitle:aTitle];
      }
  }
  
***************
*** 4436,4442 ****
      PTYTab *aTab = [tabViewItem identifier];
      PseudoTerminal *term = (PseudoTerminal *)[aTabBarControl delegate];
  
!     if ([term numberOfTabs] == 1) {
          [term fitWindowToTabs];
      } else {
          [term fitTabToWindow:aTab];
--- 4445,4451 ----
      PTYTab *aTab = [tabViewItem identifier];
      PseudoTerminal *term = (PseudoTerminal *)[aTabBarControl delegate];
  
!     if (true) { // PATCH: (Modified) Prevents title bar from showing
          [term fitWindowToTabs];
      } else {
          [term fitTabToWindow:aTab];
***************
*** 4940,4948 ****
          [_contentView.tabBarControl setTabColor:color forTabViewItem:tabViewItem];
          if ([_contentView.tabView selectedTabViewItem] == tabViewItem) {
              NSColor* newTabColor = [_contentView.tabBarControl tabColorForTabViewItem:tabViewItem];
!             if ([_contentView.tabView numberOfTabViewItems] == 1 &&
!                 [iTermPreferences boolForKey:kPreferenceKeyHideTabBar] &&
!                 newTabColor) {
                  [self setBackgroundColor:newTabColor];
  
                  [_contentView setColor:newTabColor];
--- 4949,4958 ----
          [_contentView.tabBarControl setTabColor:color forTabViewItem:tabViewItem];
          if ([_contentView.tabView selectedTabViewItem] == tabViewItem) {
              NSColor* newTabColor = [_contentView.tabBarControl tabColorForTabViewItem:tabViewItem];
!             if (true) { // PATCH: (Modified) always use the tab color
!                 // PATCH: (Added) set window title background so it renders properly
!                 NSTextView *titleView = [self.contentView.window standardWindowButton:NSWindowCloseButton].superview.subviews[3];
!                 titleView.backgroundColor = [self.tabs[0].sessions[0].colorMap colorForKey:kColorMapBackground];
                  [self setBackgroundColor:newTabColor];
  
                  [_contentView setColor:newTabColor];
***************
*** 4967,4972 ****
--- 4977,4986 ----
                  break;
          }
      }
+     
+     // PATCH: (Added) set window background color to terminal background color
+     backgroundColor = [self.tabs[0].sessions[0].colorMap colorForKey:kColorMapBackground];
+     
      [self.window setBackgroundColor:backgroundColor];
      if (backgroundColor != nil && backgroundColor.perceivedBrightness < 0.5) {
          self.window.appearance = [NSAppearance appearanceNamed:NSAppearanceNameVibrantDark];
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/iTermAdvancedSettingsModel.h iTerm2-patched/sources/iTermAdvancedSettingsModel.h
*** iTerm2/sources/iTermAdvancedSettingsModel.h	2018-05-26 17:14:31.000000000 +1000
--- iTerm2-patched/sources/iTermAdvancedSettingsModel.h	2018-05-26 16:16:47.000000000 +1000
***************
*** 41,46 ****
--- 41,53 ----
  + (BOOL)pinchToChangeFontSizeDisabled;
  + (BOOL)doNotSetCtype;
  
+ // PATCH: (Added) iTerm2-borderless Features
+ + (double)timeBeforeBlinks;
+ + (BOOL)setCursorForegroundColor;
+ + (NSString *)windowTitleFormat;
+ + (int)standardWindowButtonsHorizontalOffset;
+ + (int)standardWindowButtonsVerticalOffset;
+ 
  // The cursor's background goes to the "most different" color from its neighbors if the difference
  // in brightness between the proposed background color and the neighbors' background color is less
  // than this threshold.
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/iTermAdvancedSettingsModel.m iTerm2-patched/sources/iTermAdvancedSettingsModel.m
*** iTerm2/sources/iTermAdvancedSettingsModel.m	2018-05-26 17:14:31.000000000 +1000
--- iTerm2-patched/sources/iTermAdvancedSettingsModel.m	2018-05-26 16:16:47.000000000 +1000
***************
*** 130,135 ****
--- 130,143 ----
  DEFINE_BOOL(enableUnderlineSemanticHistoryOnCmdHover, YES, @"Mouse: Underline Semantic History-selectable items under the cursor while holding ⌘?");
  DEFINE_BOOL(sensitiveScrollWheel, NO, @"Mouse: Scroll on any scroll wheel movement, no matter how small?");
  
+ // PATCH: (Added) iTerm2-borderless Features
+ #pragma mark iTerm2-borderless Preferences
+ DEFINE_FLOAT(timeBeforeBlinks, 0.5, @"iTerm2-borderless Features: Duration before cursor starts blinking.");
+ DEFINE_BOOL(setCursorForegroundColor, YES, @"iTerm2-borderless Features: Set cursor foreground color.");
+ DEFINE_STRING(windowTitleFormat, @"%@", @"iTerm2-borderless Features: Window title format\n“%@” represents the current session name, e.g. 'Terminal - %@'")
+ DEFINE_INT(standardWindowButtonsHorizontalOffset, 17, @"iTerm2-borderless Features: Standard window buttons horizontal offset")
+ DEFINE_INT(standardWindowButtonsVerticalOffset, 8, @"iTerm2-borderless Features: Standard window buttons vertical offset")
+ 
  #pragma mark Terminal
  DEFINE_BOOL(traditionalVisualBell, NO, @"Terminal: Visual bell flashes the whole screen, not just a bell icon.");
  DEFINE_FLOAT(timeBetweenBlinks, 0.5, @"Terminal: Cursor blink speed (seconds).");
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/iTermCursor.m iTerm2-patched/sources/iTermCursor.m
*** iTerm2/sources/iTermCursor.m	2018-05-26 17:14:31.000000000 +1000
--- iTerm2-patched/sources/iTermCursor.m	2018-05-26 16:36:07.000000000 +1000
***************
*** 209,217 ****
                                       coord:coord];
          } else {
              // Non-smart
              [self.delegate cursorDrawCharacterAt:coord
                                       doubleWidth:doubleWidth
!                                    overrideColor:foregroundColor
                                           context:ctx
                                   backgroundColor:backgroundColor];
          }
--- 209,218 ----
                                       coord:coord];
          } else {
              // Non-smart
+             // PATCH: (Modified) Set cursor foreground color
              [self.delegate cursorDrawCharacterAt:coord
                                       doubleWidth:doubleWidth
!                                    overrideColor:[iTermAdvancedSettingsModel setCursorForegroundColor] == YES ? foregroundColor : nil
                                           context:ctx
                                   backgroundColor:backgroundColor];
          }
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/iTermRootTerminalView.m iTerm2-patched/sources/iTermRootTerminalView.m
*** iTerm2/sources/iTermRootTerminalView.m	2018-05-26 17:14:31.000000000 +1000
--- iTerm2-patched/sources/iTermRootTerminalView.m	2018-05-25 22:14:57.000000000 +1000
***************
*** 16,22 ****
  #import "iTermToolbeltView.h"
  #import "PTYTabView.h"
  
! const CGFloat kHorizontalTabBarHeight = 24;
  const CGFloat kDivisionViewHeight = 1;
  
  static const CGFloat kMinimumToolbeltSizeInPoints = 100;
--- 16,22 ----
  #import "iTermToolbeltView.h"
  #import "PTYTabView.h"
  
! const CGFloat kHorizontalTabBarHeight = 0; // PATCH: (Modified) No tab bar
  const CGFloat kDivisionViewHeight = 1;
  
  static const CGFloat kMinimumToolbeltSizeInPoints = 100;
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/iTermTextDrawingHelper.m iTerm2-patched/sources/iTermTextDrawingHelper.m
*** iTerm2/sources/iTermTextDrawingHelper.m	2018-05-26 17:14:31.000000000 +1000
--- iTerm2-patched/sources/iTermTextDrawingHelper.m	2018-05-26 16:52:39.000000000 +1000
***************
*** 2572,2581 ****
  }
  
  - (BOOL)shouldShowCursor {
      if (_cursorBlinking &&
          self.isInKeyWindow &&
          _textViewIsActiveSession &&
!         [NSDate timeIntervalSinceReferenceDate] - _lastTimeCursorMoved > 0.5) {
          // Allow the cursor to blink if it is configured, the window is key, this session is active
          // in the tab, and the cursor has not moved for half a second.
          return _blinkingItemsVisible;
--- 2572,2582 ----
  }
  
  - (BOOL)shouldShowCursor {
+     // PATCH: (Modified) Blink delay after moving the cursor
      if (_cursorBlinking &&
          self.isInKeyWindow &&
          _textViewIsActiveSession &&
!         [NSDate timeIntervalSinceReferenceDate] - _lastTimeCursorMoved > [iTermAdvancedSettingsModel timeBeforeBlinks]) {
          // Allow the cursor to blink if it is configured, the window is key, this session is active
          // in the tab, and the cursor has not moved for half a second.
          return _blinkingItemsVisible;
diff --exclude=.git -x '*.orig' -x '*.rej' -x build -Prc iTerm2/sources/iTermWindowImpl.m iTerm2-patched/sources/iTermWindowImpl.m
*** iTerm2/sources/iTermWindowImpl.m	2018-05-26 17:14:31.000000000 +1000
--- iTerm2-patched/sources/iTermWindowImpl.m	2018-05-26 16:14:54.000000000 +1000
***************
*** 26,31 ****
--- 26,33 ----
      double _cachedTotalOcclusion;
  
      NSTimeInterval _timeOfLastWindowTitleChange;
+     
+     NSTextView *titleView;
  }
  
  - (instancetype)initWithContentRect:(NSRect)contentRect
***************
*** 42,47 ****
--- 44,50 ----
          DLog(@"Invalidate cached occlusion: %@ %p", NSStringFromSelector(_cmd), self);
          [[iTermWindowOcclusionChangeMonitor sharedInstance] invalidateCachedOcclusion];
      }
+ 
      return self;
  }
  
***************
*** 55,67 ****
  
  }
  
  - (BOOL)titleChangedRecently {
      NSTimeInterval now = [NSDate timeIntervalSinceReferenceDate];
      return (now > _timeOfLastWindowTitleChange && now - _timeOfLastWindowTitleChange < iTermWindowTitleChangeMinimumInterval);
  }
  
  - (void)setTitle:(NSString *)title {
!     [super setTitle:title];
      _timeOfLastWindowTitleChange = [NSDate timeIntervalSinceReferenceDate];
  }
  
--- 58,102 ----
  
  }
  
+ // PATCH: (Added) Modify standard title bar
+ - (void)layoutIfNeeded {
+     NSButton *closeButton = [self.contentView.window standardWindowButton:NSWindowCloseButton];
+     NSButton *miniaturizeButton = [self.contentView.window standardWindowButton:NSWindowMiniaturizeButton];
+     NSButton *fullscreenButton = [self.contentView.window standardWindowButton:NSWindowZoomButton];
+     
+     int horizOff = [iTermAdvancedSettingsModel standardWindowButtonsHorizontalOffset];
+     int vertOff = [iTermAdvancedSettingsModel standardWindowButtonsVerticalOffset];
+     
+     [closeButton setFrameOrigin:NSMakePoint(0 + horizOff, 3)];
+     [miniaturizeButton setFrameOrigin:NSMakePoint(20 + horizOff, 3)];
+     [fullscreenButton setFrameOrigin:NSMakePoint(40 + horizOff, 3)];
+     
+     NSView *lights = closeButton.superview.superview;
+     NSRect newFrame = lights.frame;
+     //lights.layer.backgroundColor = [NSColor grayColor].CGColor;
+     newFrame.origin.y = self.contentView.frame.size.height - vertOff;
+     lights.frame = newFrame;
+     
+     NSTextView *titleView = closeButton.superview.subviews[3];
+     
+     titleView.font = [NSFont systemFontOfSize:13];
+     [titleView removeConstraints:titleView.constraints];
+     CGRect frame = titleView.frame;
+     frame.size.width = 200;
+     frame.origin.y = 3;
+     titleView.frame = frame;
+     titleView.drawsBackground = true;
+     
+     [super layoutIfNeeded];
+ }
+ 
  - (BOOL)titleChangedRecently {
      NSTimeInterval now = [NSDate timeIntervalSinceReferenceDate];
      return (now > _timeOfLastWindowTitleChange && now - _timeOfLastWindowTitleChange < iTermWindowTitleChangeMinimumInterval);
  }
  
  - (void)setTitle:(NSString *)title {
!     [super setTitle:title]; // PATCH: (Modified) Change window title to "Terminal"
      _timeOfLastWindowTitleChange = [NSDate timeIntervalSinceReferenceDate];
  }
  
